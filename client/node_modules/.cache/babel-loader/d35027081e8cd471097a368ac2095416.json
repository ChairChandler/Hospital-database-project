{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar ReactDom = require(\"react-dom\");\n\nvar tubular_common_1 = require(\"tubular-common\");\n\nvar helpers_1 = require(\"./helpers\");\n\nvar createTbOptions = function (tubularOptions) {\n  var temp = tubularOptions || {};\n  return {\n    callbacks: temp.callbacks || {\n      onError: function () {\n        return;\n      }\n    },\n    componentName: temp.componentName || helpers_1.tbId(),\n    deps: temp.deps || null,\n    pagination: temp.pagination || {\n      itemsPerPage: 10,\n      page: 0\n    },\n    searchText: temp.searchText || '',\n    storage: temp.componentName && temp.storage || new tubular_common_1.NullStorage()\n  };\n};\n\nexports.useTubular = function (initColumns, source, tubularOptions) {\n  var tbOptions = createTbOptions(tubularOptions);\n  var componentName = tbOptions.componentName,\n      pagination = tbOptions.pagination,\n      callbacks = tbOptions.callbacks,\n      storage = tbOptions.storage,\n      deps = tbOptions.deps,\n      searchText = tbOptions.searchText;\n  var initStorage = storage || new tubular_common_1.NullStorage();\n\n  if (initStorage instanceof tubular_common_1.LocalStorage) {\n    initStorage.setGridName(componentName);\n  }\n\n  var _a = React.useState(false),\n      isLoading = _a[0],\n      setIsLoading = _a[1];\n\n  var _b = React.useState(initColumns),\n      getColumns = _b[0],\n      setColumns = _b[1];\n\n  var _c = React.useState(false),\n      isStorageLoaded = _c[0],\n      setIsStorageLoaded = _c[1];\n\n  var _d = React.useState(null),\n      getActiveColumn = _d[0],\n      setActiveColumn = _d[1];\n\n  var _e = React.useState(pagination.itemsPerPage || 10),\n      getItemsPerPage = _e[0],\n      setItemsPerPage = _e[1];\n\n  var getStorage = React.useState(initStorage)[0];\n\n  var _f = React.useState(pagination.page || 0),\n      getPage = _f[0],\n      setPage = _f[1];\n\n  var _g = React.useState(searchText || ''),\n      getSearchText = _g[0],\n      setSearchText = _g[1];\n\n  var _h = React.useState(null),\n      getError = _h[0],\n      setError = _h[1];\n\n  var getAllRecords = source instanceof Array ? helpers_1.getLocalDataSource(source) : helpers_1.getRemoteDataSource(source);\n\n  var _j = React.useState({\n    aggregate: null,\n    data: [],\n    filteredRecordCount: 0,\n    totalRecordCount: 0\n  }),\n      getState = _j[0],\n      setState = _j[1];\n\n  var api = {\n    exportTo: function (allRows, exportFunc) {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var payload, _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (getState.filteredRecordCount === 0) {\n                return [2\n                /*return*/\n                ];\n              }\n\n              if (!allRows) return [3\n              /*break*/\n              , 1];\n              _a = getState.data;\n              return [3\n              /*break*/\n              , 3];\n\n            case 1:\n              return [4\n              /*yield*/\n              , getAllRecords(new tubular_common_1.GridRequest(getColumns, -1, 0, getSearchText))];\n\n            case 2:\n              _a = _b.sent().payload;\n              _b.label = 3;\n\n            case 3:\n              payload = _a;\n              exportFunc(payload, getColumns);\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    },\n    goToPage: function (page) {\n      if (getPage !== page) {\n        setPage(page);\n      }\n    },\n    handleFilterChange: function (value) {\n      setActiveColumn(__assign(__assign({}, getActiveColumn), {\n        filter: __assign(__assign({}, getActiveColumn.filter), value)\n      }));\n    },\n    processRequest: function () {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var request, response_1, maxPage, currentPage_1, err_1;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              setIsLoading(true);\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              request = new tubular_common_1.GridRequest(getColumns, getItemsPerPage, getPage, getSearchText);\n              return [4\n              /*yield*/\n              , getAllRecords(request)];\n\n            case 2:\n              response_1 = _a.sent();\n              maxPage = Math.ceil(response_1.totalRecordCount / getItemsPerPage);\n              currentPage_1 = response_1.currentPage > maxPage ? maxPage : response_1.currentPage;\n              currentPage_1 = currentPage_1 === 0 ? 0 : currentPage_1 - 1; // TODO: Check this won't case an issue\n\n              ReactDom.unstable_batchedUpdates(function () {\n                getStorage.setPage(currentPage_1);\n                getStorage.setColumns(getColumns);\n                getStorage.setTextSearch(getSearchText);\n                setState({\n                  aggregate: response_1.aggregationPayload,\n                  data: response_1.payload,\n                  filteredRecordCount: response_1.filteredRecordCount || 0,\n                  totalRecordCount: response_1.totalRecordCount || 0\n                });\n                setIsLoading(false);\n                setError(null);\n                setPage(currentPage_1);\n              });\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              err_1 = _a.sent();\n\n              if (callbacks.onError) {\n                callbacks.onError(err_1);\n              }\n\n              setIsLoading(false);\n              setError(err_1);\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    },\n    setActiveColumn: setActiveColumn,\n    setFilter: function (value) {\n      var columns = __spreadArrays(getColumns);\n\n      var column = columns.find(function (c) {\n        return c.name === getActiveColumn.name;\n      });\n\n      if (!column) {\n        return;\n      }\n\n      column.filter = __assign(__assign({}, getActiveColumn.filter), value);\n      setColumns(__spreadArrays(columns));\n    },\n    sortColumn: function (property, multiSort) {\n      if (multiSort === void 0) {\n        multiSort = false;\n      }\n\n      var columns = tubular_common_1.ColumnModel.sortColumnArray(property, __spreadArrays(getColumns), multiSort);\n      setColumns(columns);\n    },\n    updateItemPerPage: function (itemsPerPage) {\n      if (getItemsPerPage !== itemsPerPage) {\n        setItemsPerPage(itemsPerPage);\n      }\n    },\n    updateSearchText: function (value) {\n      if (getSearchText !== value) {\n        setSearchText(value);\n      }\n    }\n  };\n  var dependencies = [getColumns, getPage, getSearchText, getItemsPerPage, source];\n\n  if (deps) {\n    dependencies = dependencies.concat(deps);\n  }\n\n  var initGrid = function () {\n    if (getStorage.getPage()) {\n      setPage(getStorage.getPage());\n    }\n\n    if (getStorage.getTextSearch()) {\n      setSearchText(getStorage.getTextSearch());\n    }\n\n    var storedColumns = getStorage.getColumns();\n\n    if (storedColumns) {\n      var columns_1 = __spreadArrays(getColumns);\n\n      storedColumns.forEach(function (column) {\n        var currentColumn = columns_1.find(function (col) {\n          return col.name === column.name;\n        });\n\n        if (!currentColumn) {\n          return;\n        }\n\n        currentColumn.visible = column.visible;\n\n        if (currentColumn.filter !== null && currentColumn.filter.text !== null) {\n          return;\n        }\n\n        if (column.filter != null && column.filter.text != null && column.filter.operator !== tubular_common_1.CompareOperators.None) {\n          currentColumn.filter = column.filter;\n        }\n      });\n      setColumns(columns_1);\n    }\n\n    setIsStorageLoaded(true);\n  };\n\n  if (!isStorageLoaded) {\n    initGrid();\n  }\n\n  React.useEffect(function () {\n    if (!isLoading) {\n      api.processRequest();\n    }\n  }, dependencies);\n  React.useEffect(function () {\n    setColumns(initColumns);\n  }, [initColumns]);\n\n  var state = __assign(__assign({}, getState), {\n    activeColumn: getActiveColumn,\n    columns: getColumns,\n    error: getError,\n    initialized: isStorageLoaded,\n    isLoading: isLoading,\n    itemsPerPage: getItemsPerPage,\n    page: getPage,\n    searchText: getSearchText,\n    storage: getStorage\n  });\n\n  return {\n    state: state,\n    api: api\n  };\n};","map":{"version":3,"sources":["/home/chairchandler/Desktop/Bazy Danych/client/node_modules/tubular-react-common/dist/useTubular.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","Array","k","a","j","jl","defineProperty","exports","React","require","ReactDom","tubular_common_1","helpers_1","createTbOptions","tubularOptions","temp","callbacks","onError","componentName","tbId","deps","pagination","itemsPerPage","page","searchText","storage","NullStorage","useTubular","initColumns","source","tbOptions","initStorage","LocalStorage","setGridName","_a","useState","isLoading","setIsLoading","_b","getColumns","setColumns","_c","isStorageLoaded","setIsStorageLoaded","_d","getActiveColumn","setActiveColumn","_e","getItemsPerPage","setItemsPerPage","getStorage","_f","getPage","setPage","_g","getSearchText","setSearchText","_h","getError","setError","getAllRecords","getLocalDataSource","getRemoteDataSource","_j","aggregate","data","filteredRecordCount","totalRecordCount","getState","setState","api","exportTo","allRows","exportFunc","payload","GridRequest","goToPage","handleFilterChange","filter","processRequest","request","response_1","maxPage","currentPage_1","err_1","Math","ceil","currentPage","unstable_batchedUpdates","setTextSearch","aggregationPayload","setFilter","columns","column","find","c","name","sortColumn","property","multiSort","ColumnModel","sortColumnArray","updateItemPerPage","updateSearchText","dependencies","concat","initGrid","getTextSearch","storedColumns","columns_1","forEach","currentColumn","col","visible","text","operator","CompareOperators","None","useEffect","state","activeColumn","error","initialized"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar ReactDom = require(\"react-dom\");\nvar tubular_common_1 = require(\"tubular-common\");\nvar helpers_1 = require(\"./helpers\");\nvar createTbOptions = function (tubularOptions) {\n    var temp = tubularOptions || {};\n    return {\n        callbacks: temp.callbacks || {\n            onError: function () {\n                return;\n            },\n        },\n        componentName: temp.componentName || helpers_1.tbId(),\n        deps: temp.deps || null,\n        pagination: temp.pagination || {\n            itemsPerPage: 10,\n            page: 0,\n        },\n        searchText: temp.searchText || '',\n        storage: (temp.componentName && temp.storage) || new tubular_common_1.NullStorage(),\n    };\n};\nexports.useTubular = function (initColumns, source, tubularOptions) {\n    var tbOptions = createTbOptions(tubularOptions);\n    var componentName = tbOptions.componentName, pagination = tbOptions.pagination, callbacks = tbOptions.callbacks, storage = tbOptions.storage, deps = tbOptions.deps, searchText = tbOptions.searchText;\n    var initStorage = storage || new tubular_common_1.NullStorage();\n    if (initStorage instanceof tubular_common_1.LocalStorage) {\n        initStorage.setGridName(componentName);\n    }\n    var _a = React.useState(false), isLoading = _a[0], setIsLoading = _a[1];\n    var _b = React.useState(initColumns), getColumns = _b[0], setColumns = _b[1];\n    var _c = React.useState(false), isStorageLoaded = _c[0], setIsStorageLoaded = _c[1];\n    var _d = React.useState(null), getActiveColumn = _d[0], setActiveColumn = _d[1];\n    var _e = React.useState(pagination.itemsPerPage || 10), getItemsPerPage = _e[0], setItemsPerPage = _e[1];\n    var getStorage = React.useState(initStorage)[0];\n    var _f = React.useState(pagination.page || 0), getPage = _f[0], setPage = _f[1];\n    var _g = React.useState(searchText || ''), getSearchText = _g[0], setSearchText = _g[1];\n    var _h = React.useState(null), getError = _h[0], setError = _h[1];\n    var getAllRecords = source instanceof Array ? helpers_1.getLocalDataSource(source) : helpers_1.getRemoteDataSource(source);\n    var _j = React.useState({\n        aggregate: null,\n        data: [],\n        filteredRecordCount: 0,\n        totalRecordCount: 0,\n    }), getState = _j[0], setState = _j[1];\n    var api = {\n        exportTo: function (allRows, exportFunc) { return __awaiter(void 0, void 0, void 0, function () {\n            var payload, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (getState.filteredRecordCount === 0) {\n                            return [2 /*return*/];\n                        }\n                        if (!allRows) return [3 /*break*/, 1];\n                        _a = getState.data;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, getAllRecords(new tubular_common_1.GridRequest(getColumns, -1, 0, getSearchText))];\n                    case 2:\n                        _a = (_b.sent()).payload;\n                        _b.label = 3;\n                    case 3:\n                        payload = _a;\n                        exportFunc(payload, getColumns);\n                        return [2 /*return*/];\n                }\n            });\n        }); },\n        goToPage: function (page) {\n            if (getPage !== page) {\n                setPage(page);\n            }\n        },\n        handleFilterChange: function (value) {\n            setActiveColumn(__assign(__assign({}, getActiveColumn), { filter: __assign(__assign({}, getActiveColumn.filter), value) }));\n        },\n        processRequest: function () { return __awaiter(void 0, void 0, void 0, function () {\n            var request, response_1, maxPage, currentPage_1, err_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        setIsLoading(true);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        request = new tubular_common_1.GridRequest(getColumns, getItemsPerPage, getPage, getSearchText);\n                        return [4 /*yield*/, getAllRecords(request)];\n                    case 2:\n                        response_1 = _a.sent();\n                        maxPage = Math.ceil(response_1.totalRecordCount / getItemsPerPage);\n                        currentPage_1 = response_1.currentPage > maxPage ? maxPage : response_1.currentPage;\n                        currentPage_1 = currentPage_1 === 0 ? 0 : currentPage_1 - 1;\n                        // TODO: Check this won't case an issue\n                        ReactDom.unstable_batchedUpdates(function () {\n                            getStorage.setPage(currentPage_1);\n                            getStorage.setColumns(getColumns);\n                            getStorage.setTextSearch(getSearchText);\n                            setState({\n                                aggregate: response_1.aggregationPayload,\n                                data: response_1.payload,\n                                filteredRecordCount: response_1.filteredRecordCount || 0,\n                                totalRecordCount: response_1.totalRecordCount || 0,\n                            });\n                            setIsLoading(false);\n                            setError(null);\n                            setPage(currentPage_1);\n                        });\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_1 = _a.sent();\n                        if (callbacks.onError) {\n                            callbacks.onError(err_1);\n                        }\n                        setIsLoading(false);\n                        setError(err_1);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); },\n        setActiveColumn: setActiveColumn,\n        setFilter: function (value) {\n            var columns = __spreadArrays(getColumns);\n            var column = columns.find(function (c) { return c.name === getActiveColumn.name; });\n            if (!column) {\n                return;\n            }\n            column.filter = __assign(__assign({}, getActiveColumn.filter), value);\n            setColumns(__spreadArrays(columns));\n        },\n        sortColumn: function (property, multiSort) {\n            if (multiSort === void 0) { multiSort = false; }\n            var columns = tubular_common_1.ColumnModel.sortColumnArray(property, __spreadArrays(getColumns), multiSort);\n            setColumns(columns);\n        },\n        updateItemPerPage: function (itemsPerPage) {\n            if (getItemsPerPage !== itemsPerPage) {\n                setItemsPerPage(itemsPerPage);\n            }\n        },\n        updateSearchText: function (value) {\n            if (getSearchText !== value) {\n                setSearchText(value);\n            }\n        },\n    };\n    var dependencies = [getColumns, getPage, getSearchText, getItemsPerPage, source];\n    if (deps) {\n        dependencies = dependencies.concat(deps);\n    }\n    var initGrid = function () {\n        if (getStorage.getPage()) {\n            setPage(getStorage.getPage());\n        }\n        if (getStorage.getTextSearch()) {\n            setSearchText(getStorage.getTextSearch());\n        }\n        var storedColumns = getStorage.getColumns();\n        if (storedColumns) {\n            var columns_1 = __spreadArrays(getColumns);\n            storedColumns.forEach(function (column) {\n                var currentColumn = columns_1.find(function (col) { return col.name === column.name; });\n                if (!currentColumn) {\n                    return;\n                }\n                currentColumn.visible = column.visible;\n                if (currentColumn.filter !== null && currentColumn.filter.text !== null) {\n                    return;\n                }\n                if (column.filter != null &&\n                    column.filter.text != null &&\n                    column.filter.operator !== tubular_common_1.CompareOperators.None) {\n                    currentColumn.filter = column.filter;\n                }\n            });\n            setColumns(columns_1);\n        }\n        setIsStorageLoaded(true);\n    };\n    if (!isStorageLoaded) {\n        initGrid();\n    }\n    React.useEffect(function () {\n        if (!isLoading) {\n            api.processRequest();\n        }\n    }, dependencies);\n    React.useEffect(function () {\n        setColumns(initColumns);\n    }, [initColumns]);\n    var state = __assign(__assign({}, getState), { activeColumn: getActiveColumn, columns: getColumns, error: getError, initialized: isStorageLoaded, isLoading: isLoading, itemsPerPage: getItemsPerPage, page: getPage, searchText: getSearchText, storage: getStorage });\n    return { state: state, api: api };\n};\n"]},"metadata":{},"sourceType":"script"}